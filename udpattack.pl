#!/usr/bin/perl -w
#
# (C) 1U Ring LLC 2013 ... Do as you wish with this script ..
#
#
# -------------------
# Ignore UDP flooders
# -------------------
# http://Packet-Craft.net/Malicious/udp-flood/udp-flood.pl
# ======================================================================
#	creates a script for network monitoring with tcpdump,
#	ignoring the *.25345 UDP flood attackers
#	so you can view the important packets
#
#	---------------------
#	Find new UDP flooders
#	---------------------
#		sh /tmp/udp-flood.sh
#
# --------------------------------------
# Defending Against these DDoS UDP Flood	( isc.org attack aka UDP amplification attack )
# --------------------------------------
#
#	http://Packet-Craft.net/Malicious/#ISC.org
#
#	- UDP is stateless... you cannot tarpit the attackers
#
# - named:
#	- use named-9.4.1-p1 or later
#	- turn off recursion in named.conf
#	- check for zone files for each domains hosted on your DNSserver
#
#
# - Typical tcpdump data
#   --------------------
#	w.x.y.z.25345 > 192.168.1.1.domain:  7490+ [1au] ANY? isc.org. (36)
#	... hundreds of these per second ...
#
#	w.x.y.z.29400 > 192.168.1.1.domain:  7490+ [1au] ANY? isc.org. (36)
#	... hundreds of these per second ...
#
#	w.x.y.z.49940 > 192.168.1.1.domain:  7490+ [1au] ANY? isc.org. (36)
#	... hundreds of these per second ...
#
#
# - iptables:
#	- you should be able to bandwidth limit these incoming udp attacks from port 25345 
#		or better still, just DROP the useless packets completely
#	- you should be able to stop these incoming udp attacks from using your bandwidth
#		by installing a firewall at your ISP ... NOT at your downlink location
#
#	# -------------------------------------------------
#	# these iptables rule should be running at your ISP
#	# -------------------------------------------------
#	iptables -I INPUT -p udp --sport 25345 -d YourDNSserver --dport 53 -j DROP
#	iptables -I INPUT -p udp --sport 29400 -d YourDNSserver --dport 53 -j DROP
#	iptables -I INPUT -p udp --sport 49940 -d YourDNSserver --dport 53 -j DROP
#
#	#
#	# http://foxpa.ws/2010/07/20/making-the-case-for-access-controlled-recursive-lookups-with-bind
#	# http://foxpa.ws/2010/11/17/isc-org-any-request-drdos-update
#	#
#	iptables -A INPUT -p udp --sport 25345 -d YourDNSserver --dport 53 \
#		-m string --hex-string "|03697363036f726700|" --algo bm --to 65535 -j DROP
#
#	iptables -A INPUT -p udp --sport 25345 -d YourDNSserver --dport 53 \
#		-m string --hex-string "|6973633f6f72673f|" --algo bm --to 65535 -j DROP 
#
#
#
# 02-Oct-12 amo Date-of-Birth
# 04-Oct-12 amo Scriptized
# 11-Oct-12 amo Create *.sh file to execute
# 13-Oct-12 amo Clean up script
# 17-Oct-12 amo Sanitized for release
# 23-Nov-12 amo Added dozen-18 more over thanxgiving ( #7 )
# 03-Jan-13 amo Added # 8
# 01-Feb-13 amo Added # 9
# 12-Feb-13 amo Sanitize for Release
# 23-Aug-13 amo Added additional source port: 29400 49940
#
#
# TCP solutions
#	- increase max connection but costs "memory"
#
#
# Other Common Un-used Ports being attacked
# -----------------------------------------
#	1433	tcp/udp	ms-sql-s        # Microsoft-SQL-Server
#	3389		rdp		# Microsoft Remote Desktop Protocol
#
#
#
use strict;
use warnings;
#
#
my ( $Network ) = "192.168.1.0";	# Network to monitor
my ( $MyHost ) = "192.168.1.1";		# host running this script
#
my ( $Script ) = "/tmp/udp-flood.sh";	# Script to run tcpdump ignoring udp flooders
#
#
print "#\n";
print "# tcpdump -nv -i eth0 '( dst net $Network/24 )' and '( not host $MyHost )' \n";
print "#\n";
#
#
# ---------------------------
# List of UDP Flood Attackers, aka zombie hosts
# ---------------------------
#	# 5 == one day
#	# 6 == Fri/Sat/Sun/Mon
#	# 7 = after html release
#
# tcpdump -n -i eth0 '( src port 25345 )'
#
# tcpdump -n -i eth0 '( dst net $Network/24 )' and '( dst port 53 )' | awk '{ print $1 " " $2 " " $3 " " $4 " " $5 }' | uniq
#
#
my ( @DropIP ) = ( 
	"5.39.2.247.2534",	# 7
	"5.39.10.55.25345",
	"5.39.19.153.25345",	# 7
	"5.39.19.157.25345",	# 7
	"5.39.122.75.25345",
	"5.82.61.191.25345",	# 7
	"5.135.60.252.25345",	# 7
	"5.135.100.89.25345",	# 8
	"5.135.210.193.25345",	# 7
	"5.135.210.195.25345 ",	# 7
	"5.135.210.200.25345",	# 7
	"5.152.197.219.25345",	# 7
	"5.178.66.107.25345",	# 9
	"24.147.228.85.25345",	# 7
	"24.171.139.79.25345",	# 8
	"24.171.139.129.25345",	# 8
	"27.55.12.6.25345",
	"31.3.245.61.25345",
	"31.3.238.68.25345",	# 7
	"31.7.56.245.25345",	# 5
	"31.7.60.198.25345",	# 5
	"31.191.221.92.25345",	# 6
	"31.193.10.145.25345",	# 5
	"31.210.45.58.25345",	# 8
	"37.1.145.18.25345",	# 6
	"37.49.226.145.25345",	# 9
	"37.49.227.104.25345",	# 8
	"37.58.73.114.25345",	# 6
	"37.59.40.114.25345",	# 7
	"37.59.60.182.25345",	# 7
	"37.59.149.10.25345",	# 8
	"37.59.181.138.25345",	# 9
	"37.59.211.243.25345",	# 7
	"37.77.82.160.25345",	# 5
	"37.130.224.9.25345",	# 5
	"37.130.224.10.25345",
	"37.130.224.113.25345",	# 7
	"37.130.224.114.25345",
	"37.130.224.116.25345",	# 7
	"37.220.25.218.25345",
	"37.221.163.143.25345",	# 7
	"41.32.133.108.25345",	# 8
	"41.35.233.174.25345",	# 8
	"41.176.214.41.25345",	# 8
	"41.178.157.96.25345",	# 6
	"41.191.57.20.25345",	# 7
	"41.234.29.38.25345",	# 9
	"46.23.72.80.25345",
	"46.165.196.177.50544",	# 8
	"41.44.76.95.25345",	# 7
	"46.105.191.85.25345",	# 9
	"46.165.196.178.41206",	# 9
	"46.166.130.52.25345",	# 7
	"46.166.164.147.25345", # 7
	"46.197.62.246.25345",	# 8
	"50.7.44.114.25345",	# 9
	"50.7.44.117.25345",	# 8
	"50.23.226.91.25345",	# 7
	"50.57.94.52.25345",	# 6
	"62.114.73.206.25345",	# 7
	"62.212.82.120.64275",	# 7
	"62.233.34.57.25345",	# 6
	"63.240.82.222.52336",	# 6
	"63.240.112.68.25345",	# 7
	"64.40.9.0.25345",	# 6
	"64.40.9.21.25345",
	"64.40.9.24.49940",	# 6
	"64.40.9.37.253450",	# 6
	"64.40.9.43.49940",	# 6
	"64.40.9.53.25345",	# 6
	"65.111.164.29.25345",	# 7
	"65.111.168.228.25345",	# 7
	"65.111.173.99.25345",	# 8
	"65.111.185.72.25345",	# 7
	"66.85.138.189.25345",	# 8
	"66.85.164.53.25345",
	"66.23.232.51.25345",	# 7
	"66.90.72.34.25345",	# 9
	"66.90.72.35.25345",	# 9
	"66.90.72.36.25345",	# 9
	"67.16.146.30.25345",	# 6
	"67.16.166.250.25345",	# 6
	"67.17.106.149.25345",	# 6
	"67.205.111.118.25345",	# 6
	"67.228.99.2.25345",	# 6
	"68.68.27.32.25345",	# 7
	"68.68.27.54.25345",
	"68.68.27.133.25345",	# 7
	"68.68.29.64.25345",	# 5
	"68.68.31.98.25345",	# 7
	"68.235.38.85.25345",	# 9
	"69.4.230.216.25345",	# 7
	"69.4.233.55.25345",	# 7
	"69.42.216.42.25345",	# 8
	"69.64.43.118.25345",	# 5
	"69.65.43.210.25345",	# 7
	"69.172.135.29.25345",	# 6
	"74.113.233.128.25345",	# 8
	"74.208.155.146.25345",	# 6
	"74.222.132.90.25345",	# 7
	"76.5.49.33.25345",	# 6
	"76.10.222.57.25345",
	"76.10.205.172.53218",
	"76.72.167.164.25345",	# 7
	"76.73.99.162.25345",	# 8
	"78.15.37.56.25345",	# 7
	"78.47.229.198.25345",	# 9
	"78.141.177.154.25345",	# 6
	"78.141.179.14.25345",	# 6
	"78.159.99.146.25345",	# 9
	"78.159.111.197.25345",	# 8
	"79.27.101.14.25345",	# 7
	"80.86.85.112.25345",	# 7
 	"80.181.33.185.25345",	# 6
	"80.237.241.69.25345",	# 7
 	"80.243.190.2.25345",
	"81.17.16.142.25345",	# 6
	"81.209.165.27.25345",	# 6
	"82.49.42.141.25345 ",	# 7
	"82.192.70.42.25345",	# 6
	"83.138.162.16.25345",	# 9
	"84.60.24.249.25345",	# 7
	"85.17.12.106.25345",	# 9
	"85.17.248.184.25345",	# 6
 	"85.25.5.71.25345",
 	"85.25.130.64.25345",	# 6
	"85.214.255.91.25345",	# 7
	"87.98.166.158.49940",	# 8
	"88.198.219.125.25345",	# 6
	"89.107.56.30.25345",	# 6
	"91.121.155.213.25345",	# 9
	"91.121.218.240.25345",	# 9
	"91.149.31.72.25345",	# 7
	"91.205.40.133.25345",	# 6
	"91.205.41.54.25345",	# 6
	"91.205.41.63.25345",	# 7
 	"91.205.43.80.25345",
	"93.46.41.154.25345",	# 7
	"93.170.109.137.25345",	# 6
	"93.170.109.247.25345",	# 7
	"93.170.126.5.25345".	# 6
	"93.170.127.33.25345",	# 8
	"93.170.127.96",	# 8 from random src ports
 	"93.170.127.93.25345",
	"94.23.2.73.25345",	# 7
	"94.23.148.196.25345",	# 8
	"94.23.146.28.25345",	# 7
	"95.107.200.20.25345",	# 6
	"95.173.162.112.25345",	# 9
	"95.173.189.180.25345",	# 9
	"95.211.146.56.25345",	# 7
	"95.211.149.201.25345",	# 7
	"95.211.201.80.25345",	# 9
	"95.211.225.167.25345",	# 9
	"95.234.191.123.25345",	# 7
	"95.236.35.2.25345",	# 6
	"95.238.172.119.25345",	# 7
 	"95.252.42.12.25345",
	"101.108.77.178.25345",	# 7
	"108.168.224.205.25345",	# 7
	"108.41.225.187.25345",
	"108.162.204.5.25345",	# 5
	"108.162.205.5.25345",	# 5
	"108.168.231.227.25345",	# 7
	"108.170.5.66.25345",	# 7
	"108.170.13.18.25345",
	"109.53.121.52.25345",	# 6
	"109.73.75.52.25345",	# 6
	"109.74.0.254.25345",	# 6
	"109.230.213.143.25345",	# 8
	"110.169.206.239.25345",	# 9
	"112.198.64.73.25345",	# 9
	"112.198.78.212.25345",	# 9
	"112.216.83.69.25345",	# 7
	"113.212.69.212.25345",	# 8
	"113.212.69.214.25345",	# 8
	"115.249.168.189.25345",	# 7
	"118.139.182.60.25345",	# 5
	"119.59.122.238.25345",
	"119.81.24.242.25345",	# 6
	"120.28.126.152.25345",	# 9
	"121.54.41.118.25345",	# 8
	"121.54.42.136.25345",	# 9
	"121.54.45.118.25345",
	"121.54.48.5.25345",	# 6
	"122.25.144.82.25345",	# 7
	"122.151.169.8.25345",	# 8
	"124.105.249.195.25345",	# 9
	"125.60.173.84.25345",	# 8
	"125.60.173.117.25345",	# 9
	"126.19.84.32.25345",	# 8
	"128.65.209.8.25345",	# 6
	"134.255.214.105.25345",	# 9
	"141.138.201.211.25345",	# 8
	"149.154.152.162.25345",
	"149.20.64.3.xx",	# 6
	"151.164.108.149.xx",
	"151.164.108.150.xx",
	"158.255.43.123.25345",	# 6
	"158.255.96.226.25345",	# 5
	"158.255.96.231.52336",	# 6
	"159.253.143.24.25345",
	"151.63.89.5.25345",	# 7
	"163.121.210.170.2534",	# 6
	"168.143.83.248.25345",	# 8
	"168.143.94.171.25345",	# 9
	"171.101.142.121.25345",	# 5
	"173.1.18.82.25345",	# 7
	"173.192.209.134.25345",	# 8
	"173.236.83.131.25345",	# 8
	"173.244.201.254.25345",	# 7
	"173.245.59.115.25345",	# 6
	"173.245.58.136.25345",	#6
	"173.255.135.172.25345",	# 6
	"173.255.135.164.25345",	# 6
	"173.255.135.168.25345",	# 7
	"173.255.135.171.25345",	# 7
	"173.255.135.173.25345",	# 6
	"173.255.135.174.25345",	# 7
	"173.255.135.169.25345",	# 6
	"173.255.136.201.25345",	# 6
	"173.255.136.205.25345",	# 6
	"174.127.72.28.25345",	# 7
	"174.127.72.35.25345",	# 7
	"174.127.80.209.25345",	# 7
	"174.127.96.174.25345",	# 7
	"174.138.162.196.25345",	# 7
	"174.138.162.202.25345",	# 7
	"174.142.53.150.25345",	# 7
	"174.142.53.230.25345",	# 6
	"176.58.126.86.25345",	# 7
	"176.227.198.149.25345",	# 6
	"177.85.101.197.25345",	# 9
	"178.32.36.23.25345",	# 7
	"178.32.41.26.25345",	# 9
	"178.32.76.101.25345",	# 7
	"178.32.76.113.25345",	# 9
	"178.32.76.117.25345",	# 7
	"178.32.76.118.25345",	# 9
	"178.32.76.121.25345",	# 8
	"178.32.138.187.25345",	# 7
	"178.32.239.65.25345",	# 7
	"178.33.238.106.25345",	# 7
	"178.217.186.219.25345 ",	# 7
	"178.132.244.16.25345",	# 7
	"178.162.184.62.25345",	# 8
	"180.190.148.102.25345 ",	# 7
	"180.194.6.205.25345",	# 6
	"180.191.138.122.25345",	# 9
	"184.4.169.204.25345",	# 6
	"184.22.241.100.51853",	# 8
	"184.22.254.30.25345",	# 7
	"184.82.100.187.25345",	# 7
	"184.95.35.130.25345",	# 7
	"184.95.63.50.25345",	# 8
	"184.107.47.33.25345",	# 7
	"184.107.208.82.25345",	# 9
	"186.79.190.254.25345",	# 7
	"186.106.120.5.25345",	# 7
	"188.40.25.2",
	"188.132.225.158.25345",	# 6
	"188.165.39.168.25345",	# 9
	"188.165.56.175.25345",	# 9
	"188.165.94.149.25345",	# 9
	"188.165.94.151.25345",	# 8
	"188.227.184.181.25345",	# 6
	"189.102.32.78.xx",	# 6 attacking :1433
	"189.170.80.164.xx",	# 6 attacking :1433
	"189.170.141.13.xx",	# 6 attacking :1433
	"192.34.57.192.25345",	# 7
	"192.210.150.10.25345",	# 8
	"195.22.200.179.25345",	# 7
	"195.36.1.104.25345",	# 7
	"195.244.58.7.25345",	# 9
	"197.162.23.119.25345",	# 7
	"197.195.139.216.25345",	# 6
	"198.15.70.91.25345",	# 7
	"198.24.154.10.25345",	# 9
	"198.61.160.92.25345",	# 6
	"198.61.161.120.25345",	# 7
	"198.101.231.171.25345",	# 6
	"198.105.210.53.25345",	# 5
	"198.105.210.54.25345",
	"198.105.212.140.25345", # 6
	"198.144.121.77.25345",	 # 7
	"198.148.112.5.25345",	# 7
	"199.59.149.30.25345",	# 9
	"199.59.160.203.25345",	# 7
	"199.59.160.142.25345",	# 7
	"199.59.162.176.25345",	# 7
	"199.71.233.186.25345",	# 6
	"199.91.125.188.25345",	# 9
	"199.188.104.241.25345",	# 9
	"199.254.63.254.xx",	# 6
	"200.11.241.124.80",
	"200.74.192.163.80",
	"202.28.27.6.25345",	# 6
	"203.115.131.116.xx",
	"203.170.145.64.25345",	# 6
	"203.177.185.196.25345",	# 6
	"203.124.96.15.25345",	# 7
	"206.80.56.240.25345",	# 7
	"206.190.158.4.25345",	# 7
	"206.190.136.252.25345 ",	# 9
	"206.190.136.254.25345",	# 9
	"206.217.193.229.25345",	# 7
	"206.217.193.230.25345",	# 7
	"206.217.196.2.25345",	# 7
	"206.217.206.13.25345",	# 7
	"206.217.206.15.25345",	# 7
	"208.43.140.1.25345 ",	# 8
	"208.80.120.57.25345",	# 6
	"208.98.36.2.25345",	# 9
	"208.98.36.15.25345",	# 9
	"208.131.138.13.49940",	# 9
	"208.131.138.43.52444",	# 9
	"208.131.138.43.52817",	# 9	=== new flood .. still coming thru 12-Feb-13
	"209.141.33.160.25345",	# 9
	"209.172.57.198.25345",	# 6
	"209.172.57.202.25345",	# 5
	"209.188.5.34.25345",	# 9
	"209.188.5.35.25345",	# 9
	"209.205.76.235.25345",	# 8
	"212.48.65.86.25345",	# 6
	"212.95.38.139.25345",	# 8
	"212.95.46.36.25345",	# 7
	"216.18.228.168.25345",	# 8
	"216.59.9.229.25345",	# 7
	"217.147.94.171.25345",	# 7
	"217.172.179.102.25345",	#7
	"217.172.180.47.25345",	# 7
	"222.182.201.109.xx"
	);
#
my ( $ip ) = 0;
my ( $w, $x, $y, $z, $port ) = 0;	# w.x.y.z.port#
#
print "#\n";
print "# Creating $Script to monitor the $Network from $MyHost..\n";
#
my ( $status ) = open ( FWR, "> $Script" );
#
#
#	udp-flood.sh -v
#
printf FWR "\ntcpdump -n \$1 -i eth0 '( dst net $Network/24 )' \\\n";
#
while ( $ip <= $#DropIP )
{
  ( $w, $x, $y, $z, $port ) = split ( /\./, $DropIP[$ip] );
  #
  printf FWR "and \'( not host $w.$x.$y.$z )'\\\n ";
  #
  $ip += 1;
  #
};
#
# ignore my own ip# running the $Script script
#
printf FWR "and \'( not host $MyHost )'\n";
#
close ( FWR );
#
chmod 0755, "/tmp/udp-flood.sh";
#
print "# \t Execute $Script\n";
print "#\n";
#
# End of file
